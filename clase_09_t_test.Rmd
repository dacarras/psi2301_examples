---
title: "Prueba t"
subtitle: "Clase 09"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(dpi=300,fig.width=7)
```

## Resumen

En este clase revisamos cuatro ejemplos de comparaciones de medias. Todos estos ejemplos son realizados empleando prueba t. Los dos primeros cubren ejemplos de comparaciones de medias de una muestra, en contraste a una media poblacional. Los siguientes ejemplos corresponden a una prueba t de muestras independientes, y luego una prueba t para comparación de muestras dependientes.

>Nota: Cada uno de los códigos incluidos en *chunks*, son redundantes entre sí, de modo que cada uno sea reproducible en sí mismo. Lo anterior quiere decir que, un usuario puede copiar y pegar todo el código de un solo *chunk*, y reproducirlo en su consola o syntax propio que quiera generar.

# Pruebas t de una sola muestra

## Prueba t para una muestra (n423)

```{r, echo=TRUE}

#------------------------------------------------------------------------------
# t test for a single sample
#------------------------------------------------------------------------------

# -----------------------------------------------
# get data from tolerance of corruption
# -----------------------------------------------

url_file  <-'https://raw.github.com/dacarras/psi2301_examples/master/data/corr_chl_16.rds'
data_corr <- readRDS(url(url_file))
library(dplyr)

# -----------------------------------------------
# get data from target group
# -----------------------------------------------

corr_0 <- data_corr %>%
          dplyr::filter(sof == 0) %>%
          dplyr::select(corr) %>%
          na.omit() %>%
          pull()


# -----------------------------------------------
# get number of observations
# -----------------------------------------------

n <- length(corr_0)

# -----------------------------------------------
# get degrees of freedom
# -----------------------------------------------

t_df <- n-1

# -----------------------------------------------
# compute t critical value
# -----------------------------------------------

t_critic <- qt(.975, df = t_df)
t_critic

# -----------------------------------------------
# compute t test
# -----------------------------------------------

t.test(x = corr_0,
       alternative = c("two.sided"),
       mu = 50, 
       paired = FALSE, 
       var.equal = FALSE,
       conf.level = 0.95)

# -----------------------------------------------
# compute t test
# -----------------------------------------------

t_value <- t.test(x = corr_0,
           alternative = c("two.sided"),
           mu = 50, 
           paired = FALSE, 
           var.equal = FALSE,
           conf.level = 0.95) %>%
           broom::tidy() %>%
           dplyr::select(statistic) %>%
           pull() %>%
           abs() %>%
           as.numeric()

# -----------------------------------------------
# visualization of p value
# -----------------------------------------------

library(ggplot2)
ggplot(data.frame(x = c(-5, 5)), aes(x)) +
  stat_function(fun = dt, args = list(df = t_df), geom = "area") +
  scale_x_continuous(breaks=seq(-3, 3, 1)) + 
  geom_vline(xintercept = t_value, color = 'red') +
  geom_vline(xintercept = - t_value, color = 'red') +
  geom_vline(xintercept = t_critic, color = 'red', linetype = 'dotted') +
  geom_vline(xintercept = - t_critic, color = 'red', linetype = 'dotted') +
  labs(
    x = 't scores', 
    y = 'density') +
  theme_minimal() +
  theme(
  panel.background = element_blank(),
  panel.grid.minor = element_blank(),
  panel.grid.major = element_blank()
  )

# -----------------------------------------------
# effect size as r coefficient
# -----------------------------------------------

sqrt(t_value^2/(t_value^2+t_df))

```


## Prueba t para una muestra (n30)

```{r, echo=TRUE}

#------------------------------------------------------------------------------
# t test for a single sample
#------------------------------------------------------------------------------

# -----------------------------------------------
# get data from tolerance of corruption
# -----------------------------------------------

url_file  <-'https://raw.github.com/dacarras/psi2301_examples/master/data/corr_n60.rds'
data_corr_n60 <- readRDS(url(url_file))
library(dplyr)

# -----------------------------------------------
# get data from target group
# -----------------------------------------------

corr_0 <- na.omit(data_corr_n60[data_corr_n60$sof==0,'corr'])$corr %>%
          as.numeric()

# -----------------------------------------------
# get number of observations
# -----------------------------------------------

n <- length(corr_0)

# -----------------------------------------------
# get degrees of freedom
# -----------------------------------------------

t_df <- n-1

# -----------------------------------------------
# compute t critical value
# -----------------------------------------------

t_critic <- qt(.975, df = t_df)
t_critic

# -----------------------------------------------
# compute t test
# -----------------------------------------------

t.test(x = corr_0,
       alternative = c("two.sided"),
       mu = 50, 
       paired = FALSE, 
       var.equal = FALSE,
       conf.level = 0.95)

# -----------------------------------------------
# compute t test
# -----------------------------------------------

t_value <- t.test(x = corr_0,
           alternative = c("two.sided"),
           mu = 50, 
           paired = FALSE, 
           var.equal = FALSE,
           conf.level = 0.95) %>%
           broom::tidy() %>%
           dplyr::select(statistic) %>%
           pull() %>%
           abs() %>%
           as.numeric()

# -----------------------------------------------
# visualization of p value
# -----------------------------------------------

library(ggplot2)
ggplot(data.frame(x = c(-5, 5)), aes(x)) +
  stat_function(fun = dt, args = list(df = t_df), geom = "area") +
  scale_x_continuous(breaks=seq(-3, 3, 1)) + 
  geom_vline(xintercept = t_value, color = 'red') +
  geom_vline(xintercept = - t_value, color = 'red') +
  geom_vline(xintercept = t_critic, color = 'red', linetype = 'dotted') +
  geom_vline(xintercept = - t_critic, color = 'red', linetype = 'dotted') +
  labs(
    x = 't scores', 
    y = 'density') +
  theme_minimal() +
  theme(
  panel.background = element_blank(),
  panel.grid.minor = element_blank(),
  panel.grid.major = element_blank()
  )

# -----------------------------------------------
# effect size as r coefficient
# -----------------------------------------------

sqrt(t_value^2/(t_value^2+t_df))

```

# Pruebas t para dos muestras

## Pruebas t para dos muestras independientes

```{r, echo=TRUE}

#------------------------------------------------------------------------------
# t test for a single sample
#------------------------------------------------------------------------------

# -----------------------------------------------
# get data from tolerance of corruption
# -----------------------------------------------

data_alcohol <- read.table("https://stats.idre.ucla.edu/stat/r/examples/alda/data/alcohol1_pp.txt", 
                header=TRUE, sep=",")
library(dplyr)

# ----------------------------------------------- 
# separate data per wave
# -----------------------------------------------

library(dplyr)
data_alc1 <- data_alcohol %>%
             dplyr::filter(age_14 == 0)

data_alc2 <- data_alcohol %>%
             dplyr::filter(age_14 == 1)

data_alc3 <- data_alcohol %>%
             dplyr::filter(age_14 == 2)

# -----------------------------------------------
# get number of observations
# -----------------------------------------------

n <- nrow(data_alc1)

# -----------------------------------------------
# get degrees of freedom
# -----------------------------------------------

t_df <- n-2

# -----------------------------------------------
# compute t critical value
# -----------------------------------------------

t_critic <- qt(.975, df = t_df)
t_critic

# ----------------------------------------------- 
# separate data per wave
# -----------------------------------------------


t.test(formula = alcuse ~ coa,
       data = data_alc1,
       alternative = c("two.sided"),
       mu = 0, 
       paired = FALSE, 
       var.equal = TRUE,
       conf.level = 0.95)


# -----------------------------------------------
# compute t test
# -----------------------------------------------

t_value <- t.test(formula = alcuse ~ coa,
           data = data_alc1,
           alternative = c("two.sided"),
           mu = 0, 
           paired = FALSE, 
           var.equal = FALSE,
           conf.level = 0.95) %>%
           broom::tidy() %>%
           dplyr::select(statistic) %>%
           pull() %>%
           abs() %>%
           as.numeric()

# -----------------------------------------------
# visualization of p value
# -----------------------------------------------

library(ggplot2)
ggplot(data.frame(x = c(-5, 5)), aes(x)) +
  stat_function(fun = dt, args = list(df = t_df), geom = "area") +
  scale_x_continuous(breaks=seq(-3, 3, 1)) + 
  geom_vline(xintercept = t_value, color = 'red') +
  geom_vline(xintercept = - t_value, color = 'red') +
  geom_vline(xintercept = t_critic, color = 'red', linetype = 'dotted') +
  geom_vline(xintercept = - t_critic, color = 'red', linetype = 'dotted') +
  labs(
    x = 't scores', 
    y = 'density') +
  theme_minimal() +
  theme(
  panel.background = element_blank(),
  panel.grid.minor = element_blank(),
  panel.grid.major = element_blank()
  )

# -----------------------------------------------
# effect size as r coefficient
# -----------------------------------------------

sqrt(t_value^2/(t_value^2+t_df))

```

## Pruebas t para dos muestras dependientes

```{r, echo=TRUE}

#------------------------------------------------------------------------------
# t test for a single sample
#------------------------------------------------------------------------------

# -----------------------------------------------
# get data from tolerance of corruption
# -----------------------------------------------

data_alcohol <- read.table("https://stats.idre.ucla.edu/stat/r/examples/alda/data/alcohol1_pp.txt", 
                header=TRUE, sep=",")
library(dplyr)

# ----------------------------------------------- 
# separate data per wave
# -----------------------------------------------

library(dplyr)
data_alc1 <- data_alcohol %>%
             dplyr::filter(age_14 == 0)

data_alc2 <- data_alcohol %>%
             dplyr::filter(age_14 == 1)

data_alc3 <- data_alcohol %>%
             dplyr::filter(age_14 == 2)

data_paired <- dplyr::bind_rows(data_alc1, data_alc2)

# -----------------------------------------------
# get number of observations
# -----------------------------------------------

n <- nrow(data_paired)

# -----------------------------------------------
# get degrees of freedom
# -----------------------------------------------

t_df <- (n/2)-1

# -----------------------------------------------
# compute t critical value
# -----------------------------------------------

t_critic <- qt(.975, df = t_df)
t_critic

# ----------------------------------------------- 
# separate data per wave
# -----------------------------------------------

t.test(formula = alcuse ~ age_14,
       data = data_paired,
       alternative = c("two.sided"),
       paired = TRUE, 
       var.equal = TRUE,
       conf.level = 0.95)

# -----------------------------------------------
# compared to a regression
# -----------------------------------------------

lm(alcuse ~ age_14, data = data_paired) %>%
broom::tidy() %>%
knitr::kable(., digits = 2)


lm(alcuse ~ age_14, data = data_paired) %>%
broom::glance() %>%
knitr::kable(., digits = 2)


# -----------------------------------------------
# compute t test
# -----------------------------------------------

data_paired %>%
group_by(age_14) %>%
summarize(
  mean = mean(alcuse, na.rm=TRUE),
  sd   = sd(alcuse, na.rm=TRUE),
  n    = n()
  ) %>%
knitr::kable(., digits = 2)


# -----------------------------------------------
# compute t test
# -----------------------------------------------

t_value <- t.test(formula = alcuse ~ age_14,
           data = data_paired,
           alternative = c("two.sided"),
           paired = TRUE, 
           var.equal = TRUE,
           conf.level = 0.95) %>%
           broom::tidy() %>%
           dplyr::select(statistic) %>%
           pull() %>%
           abs() %>%
           as.numeric()

# -----------------------------------------------
# visualization of p value
# -----------------------------------------------

library(ggplot2)
ggplot(data.frame(x = c(-5, 5)), aes(x)) +
  stat_function(fun = dt, args = list(df = t_df), geom = "area") +
  scale_x_continuous(breaks=seq(-3, 3, 1)) + 
  geom_vline(xintercept = t_value, color = 'red') +
  geom_vline(xintercept = - t_value, color = 'red') +
  geom_vline(xintercept = t_critic, color = 'red', linetype = 'dotted') +
  geom_vline(xintercept = - t_critic, color = 'red', linetype = 'dotted') +
  labs(
    x = 't scores', 
    y = 'density') +
  theme_minimal() +
  theme(
  panel.background = element_blank(),
  panel.grid.minor = element_blank(),
  panel.grid.major = element_blank()
  )

# -----------------------------------------------
# effect size as r coefficient
# -----------------------------------------------

sqrt(t_value^2/(t_value^2+t_df))

```